<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<title>Admin – Управление пользователями</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body>

	<!-- ===== HEADER ===== -->
	<header class="header-top">
		<div
			class="container d-flex justify-content-between align-items-center">

			<!-- LOGO -->
			<div>
				<a href="/" class="text-dark text-decoration-none fs-4 fw-bold">
					NewsPortal </a>
			</div>

			<div class="d-flex align-items-center">

				<!-- Language -->
				<div class="language-switcher me-3">
					<span>Language:</span> <a href="/SwitchLanguage?lang=ru">
						<button class="btn btn-sm btn-outline-secondary">RU</button>
					</a> <a href="/SwitchLanguage?lang=en">
						<button class="btn btn-sm btn-outline-secondary">EN</button>
					</a> <a href="/SwitchLanguage?lang=by">
						<button class="btn btn-sm btn-outline-secondary">BY</button>
					</a>
				</div>

				<!-- AUTH BLOCK -->
				<div>

					<!-- USER / ADMIN -->
					<div th:if="${currentUserName != null}">
						<span class="me-3"> Привет, <b th:text="${currentUserName}">Admin</b>!
							<span th:if="${currentUser != null and currentUser.role != null}">
								<span th:if="${currentUser.role.name() == 'ADMIN'}"
								class="badge bg-danger ms-2">ADMIN</span>
						</span>
						</span>

						<!-- CREATE NEWS -->
						<a th:if="${currentUser.role.name() == 'ADMIN'}"
							href="/page_create_news" class="btn btn-primary btn-sm me-2">
							<i class="bi bi-plus-circle"></i> Новость
						</a>

						<!-- PROFILE -->
						<a href="/page_profile"
							class="btn btn-sm btn-outline-secondary me-2"> <i
							class="bi bi-person-circle"></i> Профиль
						</a>

						<!-- LOGOUT -->
						<form th:action="@{/logout}" method="post" style="display: inline">
							<button class="btn btn-sm btn-outline-danger">Выход</button>
						</form>
					</div>

				</div>
			</div>
		</div>
	</header>

	<div class="container mt-4">
		<h3 class="mb-4">
			<i class="bi bi-people"></i> Управление пользователями
		</h3>

		<!-- Сообщения об успехе или ошибке -->
		<div th:if="${successMessage}" class="alert alert-success"
			th:text="${successMessage}"></div>
		<div th:if="${errorMessage}" class="alert alert-danger"
			th:text="${errorMessage}"></div>

		<table class="table table-bordered align-middle">
			<thead>
				<tr>
					<th>Имя</th>
					<th>Фамилия</th>
					<th>Email</th>
					<th>Дата регистрации</th>
					<th>Активность</th>
					<th>Автор</th>
					<th>Действия</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="user : ${users}">
					<form th:action="@{'/user/update_admin_user/' + ${user.id}}"
						method="post">
						<input type="hidden" th:name="${_csrf.parameterName}"
							th:value="${_csrf.token}" />
						<td><input type="text" class="form-control"
							th:value="${user.name}" readonly /></td>
						<td><input type="text" class="form-control"
							th:value="${user.surname}" readonly /></td>
						<td th:text="${user.email}"></td>
						<td th:text="${user.registrationDate}"></td>
						<td class="text-center"><input type="checkbox" name="active"
							th:checked="${user.activ}"
							th:disabled="${currentUser != null and user.id == currentUser.id}" />
						</td>

						<td class="text-center"><input type="checkbox" name="author"
							th:checked="${user.author}" /></td>
						<td>
							<div class="d-flex gap-2">

								<!-- СОХРАНИТЬ (текущая форма update) -->
								<button class="btn btn-sm btn-primary">
									<i class="bi bi-save"></i> Сохранить
								</button>

								<!-- УДАЛИТЬ (отдельная форма) -->
								<form th:action="@{/user/delete}" method="post"
									th:if="${currentUser == null or user.id != currentUser.id}"
									onsubmit="return confirm('Вы уверены, что хотите удалить пользователя?');">

									<input type="hidden" name="userId" th:value="${user.id}" /> <input
										type="hidden" th:name="${_csrf.parameterName}"
										th:value="${_csrf.token}" />

									<button type="submit" class="btn btn-sm btn-danger">
										<i class="bi bi-trash"></i>
									</button>
								</form>

							</div>
						</td>
					</form>
				</tr>
			</tbody>
		</table>
	</div>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
